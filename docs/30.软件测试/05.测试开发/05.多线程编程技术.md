# 多线程编程技术

## 一、多线程的概述

### 1. 进程与线程

-   **进程** ：在系统中正在运行的一个 **应用程序** ，程序一旦运行就是进程。
    -   **进程 --- 资源分配的最小单位**。
-   **线程** ： 系统分配处理时间资源的基本单元，或者说进程之内独立执行的一个单元试行流。
    -   **线程 --- 程序执行的最小单位。**
-   **进程 中最少有一个线程。**

![image-20210413160838326](https://i.loli.net/2021/04/13/LFuEla7WZshNm6K.png)

### 2.进程的组成

-   **内存** ： 每个进程的内存是相互独立的。

-   **文件/网络句柄** ： 它们是所有的进程所共有的。

-   **线程**

    ::: tip

    所有的 **线程 共享** 该进程的所有资源。 

    :::

### 3. 进程与线程---汇总

1.  进程有分配已大部分的内存，而线程只需要分配一部分栈就可以了。
2.  一个程序至少有一个进程，一个进程至少有一个线程。
3.  进程是资源分配的最小单位，线程是程序执行的最小单位。
4.  一个线程可以创建和撤销另一个线程，同一个进程中的多个线程之间可以并发执行。

### 4.多线程

1.  使用线程可以把 **占据长时间** 的程序中的任务放到后台去处理。
2.  用户界面可以更加吸引人。
3.  程序的运行速度可能加快。
4.  在一些 **等待的任务** 的实现上，线程就比较有用。

### 5.多线程的执行方式

-   **串行** ：依次执行所有的线程，上一个线程没有执行完之前，下一个线程不会执行。
-   **并行** ： 所有线程同时执行。
-   **并发** ： 所有线程依次 **交替** 执行。

## 二、Threading 模块

### 1. Threading 模块 常用方法

-   **`Thread（）`** ： 创建线程，`target` 为需要执行的函数，`args` 为执行函数的实参（参数为元组）

-   **`run（）`** ： 用以表示线程活动的方法。
-   **`start（）`** ： 启动线程活动。
-   **`join（[time]）`** ： 等待至线程中止。这阻塞调用线程直至线程的 `join（）` 方法被调用中止 - 正常退出或者抛出未处理的异常 - 或者是可选的超时发生。
-   **`isAlive（）`** ： 返回线程是否活动的。
-   **`gitName（）`** ： 返回线程名。
-   **`setName（）`** ： 设置线程名。
-   **`threading.currentThread（）`** ： 返回当前的线程变量。
-   **`threading.enumerate（）`** ： 返回一个包含正在运行的线程的 `list` 。**正在运行** 指线程启动后、结束前，**不包含** 启动前和终止后的线程。
-   **`threading.activeCount（）`** ： 返回正在运行的线程数量，与 `len（threading.enumerate（））` 有相同的结果。

### 2.多线程案例

普通方法：

```python
import time

def doing(something):
    time.sleep(2)
    print("正在做 >>> :", something)

start_time = time.time()
doing("在学习")
doing("在加班")
end_time = time.time()

print("使用时间：", end_time-start_time)		# 4
```

多线程方法：

```python
import threading
import time

def doing(something):
    print("正在做 >>> :", something)
    time.sleep(2)

start_time = time.time()
# 1.创建线程
"""
target : 需要执行的函数名
args ： 执行函数的实参（参数为元组）
"""
a = threading.Thread(target=doing, args=("在学习",))
b = threading.Thread(target=doing, args=("在加班",))

# 2.启动子线程
a.start()
b.start()

# 3.阻塞主线程，直到子线程全部结束
a.join()
b.join()
end_time = time.time()

print("使用时间：", end_time-start_time)		# 2
```


# Git 技术

## 一、 git 工作流程

1.  克隆远程仓库到本地 （`clone`）
2.  在本地仓库中 checkout 代码 --- 进行编程 或者拉取 远程仓库代码（`pull`）
3.  在提交到本地仓库前 --- 需要到暂存区
4.  提交到本地仓库 （`commit`）
5.  推送到远程仓库（`push`）

![image-20210731153241039](https://pupperc.com/img/20210731153241.png)

## 一、 gitlab 搭建

### 1. 创建 gitlub 挂载目录

```shell
mkdir /var/github
```

```shell
cd /var/github
```

```shell
mkdir config logs data
```

### 2. 拉取 gtilab 镜像

#### 1. 搜索镜像

```shell
docker search gitlab
```

![image-20210731154602775](https://pupperc.com/img/20210731154603.png)

#### 2. 拉取 镜像

```shell
docker pull gitlab/gitlab-ce
```

![image-20210731155052757](https://pupperc.com/img/20210731155052.png)

#### 3. 检查 拉取的镜像

```shell
docker images
```

![image-20210731155129247](https://pupperc.com/img/20210731155129.png)

### 3. 创建 gitlab 容器

```shell
docker run -id -p 443:443 -p 9001:80 -p 8022:22 --hostname 服务器IP --name=gitlab --restart always -v /var/gitlab/config:/etc/gitlab -v /var/gitlab/logs:/var/log/gitlab -v /var/gitlab/data:/var/opt/gitlab -v /etc/localtime:/etc/localtime:ro --privileged=true gitlab/gitlab-ce
```

### 4.  gitlab 验证

网页打开：`服务器ip:9001`

>   默认用户名为：`root`
>
>   初始登录需要修改密码，8位以上

![image-20210731172238747](https://pupperc.com/img/20210731172239.png)

### 5. 报 502 错误解决办法

#### 1. 进入容器 重启服务

```shell
docker exec -it 容器名或id /bin/bash

gitlab-ctl reconfigure
gitlab-ctl restart
```

#### 2. 端口占用 --- 修改端口

使用工具打开文件 `hostconfig.json`，修改 大括号内的 端口号（宿主机端口）

文件目录：`/var/lib/docker/containers/容器id`

```json
"PortBindings":{"22/tcp":[{"HostIp":"","HostPort":"8022"}],"443/tcp":[{"HostIp":"","HostPort":"443"}],"80/tcp":[{"HostIp":"","HostPort":"9002"}]}
```

![image-20210731174432443](https://pupperc.com/img/20210731174432.png)

#### 3. 内存占用过多

